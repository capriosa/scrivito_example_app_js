var InstantClick=function(e,t){function n(e){var t=e.indexOf("#");return 0>t?e:e.substr(0,t)}function o(e){for(;e&&"A"!=e.nodeName;)e=e.parentNode;return e}function r(e){var i=t.protocol+"//"+t.host;if(!(i=e.target||e.hasAttribute("download")||0!=e.href.indexOf(i+"/")||-1<e.href.indexOf("#")&&n(e.href)==v)){if(T){e:{do{if(!e.hasAttribute)break;if(e.hasAttribute("data-no-instant"))break;if(e.hasAttribute("data-instant")){e=!0;break e}}while(e=e.parentNode);e=!1}e=!e}else e:{do{if(!e.hasAttribute)break;if(e.hasAttribute("data-instant"))break;if(e.hasAttribute("data-no-instant")){e=!0;break e}}while(e=e.parentNode);e=!1}i=e}return i?!1:!0}function s(e,t,i,n){for(var o=!1,r=0;r<_[e].length;r++)if("receive"==e){var s=_[e][r](t,i,n);s&&("body"in s&&(i=s.body),"title"in s&&(n=s.title),o=s)}else _[e][r](t,i,n);return o}function a(t,i,o,r){if(e.documentElement.replaceChild(i,e.body),o){if(history.pushState(null,null,o),i=o.indexOf("#"),i=i>-1&&e.getElementById(o.substr(i+1)),r=0,i)for(;i.offsetParent;)r+=i.offsetTop,i=i.offsetParent;scrollTo(0,r),v=n(o)}else scrollTo(0,r);e.title=S&&e.title==t?t+String.fromCharCode(160):t,f(),H.done(),s("change",!1),t=e.createEvent("HTMLEvents"),t.initEvent("instantclick:newpage",!0,!0),dispatchEvent(t)}function l(e){w>+new Date-500||(e=o(e.target))&&r(e)&&g(e.href)}function c(e){w>+new Date-500||(e=o(e.target))&&r(e)&&(e.addEventListener("mouseout",h),$?(y=e.href,b=setTimeout(g,$)):g(e.href))}function u(e){w=+new Date,(e=o(e.target))&&r(e)&&(C?e.removeEventListener("mousedown",l):e.removeEventListener("mouseover",c),g(e.href))}function d(e){var t=o(e.target);!t||!r(t)||1<e.which||e.metaKey||e.ctrlKey||(e.preventDefault(),m(t.href))}function h(){b?(clearTimeout(b),b=!1):q&&!I&&(x.abort(),I=q=!1)}function p(){if(!(4>x.readyState)&&0!=x.status){if(D.ready=+new Date-D.start,x.getResponseHeader("Content-Type").match(/\/(x|ht|xht)ml/)){var t=e.implementation.createHTMLDocument("");t.documentElement.innerHTML=x.responseText.replace(/<noscript[\s\S]+<\/noscript>/gi,""),O=t.title,z=t.body;var i=s("receive",A,z,O);i&&("body"in i&&(z=i.body),"title"in i&&(O=i.title)),i=n(A),P[i]={body:z,title:O,scrollY:i in P?P[i].scrollY:0};for(var o,t=t.head.children,i=0,r=t.length-1;r>=0;r--)if(o=t[r],o.hasAttribute("data-instant-track")){o=o.getAttribute("href")||o.getAttribute("src")||o.innerHTML;for(var a=L.length-1;a>=0;a--)L[a]==o&&i++}i!=L.length&&(M=!0)}else M=!0;I&&(I=!1,m(A))}}function f(t){if(e.body.addEventListener("touchstart",u,!0),C?e.body.addEventListener("mousedown",l,!0):e.body.addEventListener("mouseover",c,!0),e.body.addEventListener("click",d,!0),!t){t=e.body.getElementsByTagName("script");var n,o,r,s;for(i=0,j=t.length;i<j;i++)n=t[i],n.hasAttribute("data-no-instant")||(o=e.createElement("script"),n.src&&(o.src=n.src),n.innerHTML&&(o.innerHTML=n.innerHTML),r=n.parentNode,s=n.nextSibling,r.removeChild(n),r.insertBefore(o,s))}}function g(e){!C&&"display"in D&&100>+new Date-(D.start+D.display)||(b&&(clearTimeout(b),b=!1),e||(e=y),q&&(e==A||I))||(q=!0,I=!1,A=e,M=z=!1,D={start:+new Date},s("fetch"),x.open("GET",e),x.send())}function m(e){"display"in D||(D.display=+new Date-D.start),b||!q?b&&A&&A!=e?t.href=e:(g(e),H.start(0,!0),s("wait"),I=!0):I?t.href=e:M?t.href=A:z?(P[v].scrollY=pageYOffset,I=q=!1,a(O,z,A)):(H.start(0,!0),s("wait"),I=!0)}var v,y,b,w,x,T,C,$,k=navigator.userAgent,S=-1<k.indexOf(" CriOS/"),E="createTouch"in e,P={},A=!1,O=!1,M=!1,z=!1,D={},q=!1,I=!1,L=[],_={fetch:[],receive:[],wait:[],change:[]},H=function(){function t(t,r){u=t,e.getElementById(a.id)&&e.body.removeChild(a),a.style.opacity="1",e.getElementById(a.id)&&e.body.removeChild(a),o(),r&&setTimeout(i,0),clearTimeout(d),d=setTimeout(n,500)}function i(){u=10,o()}function n(){u+=1+2*Math.random(),u>=98?u=98:d=setTimeout(n,500),o()}function o(){l.style[c]="translate("+u+"%)",e.getElementById(a.id)||e.body.appendChild(a)}function r(){e.getElementById(a.id)?(clearTimeout(d),u=100,o(),a.style.opacity="0"):(t(100==u?0:u),setTimeout(r,0))}function s(){a.style.left=pageXOffset+"px",a.style.width=innerWidth+"px",a.style.top=pageYOffset+"px";var e="orientation"in window&&90==Math.abs(orientation);a.style[c]="scaleY("+innerWidth/screen[e?"height":"width"]*2+")"}var a,l,c,u,d;return{init:function(){a=e.createElement("div"),a.id="instantclick",l=e.createElement("div"),l.id="instantclick-bar",l.className="instantclick-bar",a.appendChild(l);var t=["Webkit","Moz","O"];if(c="transform",!(c in l.style))for(var i=0;3>i;i++)t[i]+"Transform"in l.style&&(c=t[i]+"Transform");var n="transition";if(!(n in l.style))for(i=0;3>i;i++)t[i]+"Transition"in l.style&&(n="-"+t[i].toLowerCase()+"-"+n);t=e.createElement("style"),t.innerHTML="#instantclick{position:"+(E?"absolute":"fixed")+";top:0;left:0;width:100%;pointer-events:none;z-index:2147483647;"+n+":opacity .25s .1s}.instantclick-bar{background:#29d;width:100%;margin-left:-100%;height:2px;"+n+":all .25s}",e.head.appendChild(t),E&&(s(),addEventListener("resize",s),addEventListener("scroll",s))},start:t,done:r}}(),F="pushState"in history&&(!k.match("Android")||k.match("Chrome/"))&&"file:"!=t.protocol;return{supported:F,init:function(){if(!v)if(F){for(var i=arguments.length-1;i>=0;i--){var o=arguments[i];!0===o?T=!0:"mousedown"==o?C=!0:"number"==typeof o&&($=o)}v=n(t.href),P[v]={body:e.body,title:e.title,scrollY:pageYOffset};for(var r,o=e.head.children,i=o.length-1;i>=0;i--)r=o[i],r.hasAttribute("data-instant-track")&&(r=r.getAttribute("href")||r.getAttribute("src")||r.innerHTML,L.push(r));x=new XMLHttpRequest,x.addEventListener("readystatechange",p),f(!0),H.init(),s("change",!0),addEventListener("popstate",function(){var e=n(t.href);e!=v&&(e in P?(P[v].scrollY=pageYOffset,v=e,a(P[e].title,P[e].body,!1,P[e].scrollY)):t.href=t.href)})}else s("change",!0)},on:function(e,t){_[e].push(t)}}}(document,location);
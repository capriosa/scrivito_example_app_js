<!DOCTYPE html> <html> <head> <meta charset=UTF-8> <meta http-equiv=X-UA-Compatible content="IE=edge"> <meta name=robots content="follow, index, noarchive"/> <title>AJAX ganz einfach - Digitaluhr für Drupal | mdwp</title> <meta name=description content=""/> <meta name=author content="Meinolf Droste"/> <meta property="og:locale" content=de_DE /> <meta property="og:url" content="http://mdwp.de/ajax-ganz-einfach-digitaluhr-fuer-drupal/"/> <meta property="og:description" content=""/> <meta property="og:type" content=website /> <meta property="og:title" content="AJAX ganz einfach - Digitaluhr für Drupal | mdwp - Digital Consulting & Services"/> <meta property="og:site_name" content=mdwp /> <meta name=viewport content="width=device-width, initial-scale=1"/> <link href="https://www.mdwp.de/ajax-ganz-einfach-digitaluhr-fuer-drupal//" rel=canonical> <link rel=stylesheet href="/assets/bootstrap/css/bootstrap.min-2568a287.css"> <link href="/favicon.ico" rel=icon type="image/ico"/> <style>
    .container img{
      max-width:100%;
      height:auto;
      
    }

    

    .navbar {
      border-radius: 0;
    }

    small, .small {
      font-size: 13px;
    }

   

  </style> </head> <body> <section id=ext_menu-0> <nav class="navbar navbar-dropdown"> <div class=container> <div class=mbr-table> <div class=mbr-table-cell> <div class=navbar-brand> <a href="https://www.mdwp.de/" class=navbar-logo><img src="/mdwp-18b096f0.gif" alt="mdwp Logo"></a> </div> </div> <div class=mbr-table-cell> <button class="navbar-toggler pull-xs-right hidden-md-up" type=button data-toggle=collapse data-target="#exCollapsingNavbar"> <div class=hamburger-icon></div> </button> <ul class="nav-dropdown collapse pull-xs-right nav navbar-nav navbar-toggleable-sm" id=exCollapsingNavbar> <li class=nav-item><a class="nav-link link" href="/about-us/">About</a></li> <li class=nav-item><a class="nav-link link" href="/referenzen/">Referenzen</a></li> <li class=nav-item><a class="nav-link link" href="/microblog/">Artikel</a></li> <li class=nav-item><a class="nav-link link" href="/kontakt/">Kontakt</a></li> <li class=nav-item><a class="nav-link link" href="/impressum/">Impressum</a></li> <li class="nav-item nav-btn"><a class="nav-link btn btn-white btn-black-outline" href="tel:+4923316285273">Tel.: 02331 62 85 27 3</a></li></ul> <button hidden="" class="navbar-toggler navbar-close" type=button data-toggle=collapse data-target="#exCollapsingNavbar"> <div class=close-icon></div> </button> </div> </div> </div> </nav> </section> <section class="mbr-info mbr-section mbr-section-md-padding" id=msg-box2-36 style="background-color: rgb(46, 46, 46); padding-top: 180px; padding-bottom: 90px;"> <div class=container> <div class=row> <div class=mbr-table-md-up> <div class="mbr-table-cell col-md-4"> <div class=text-xs-center><a class="btn btn-primary" href="/microblog/">Archiv</a></div> </div> <div class="mbr-table-cell mbr-right-padding-md-up col-md-8 text-xs-center text-md-left"> <h3 class="mbr-info-title mbr-section-title display-2">Drupal Blog</h3> <small class=text-white>2005 - 2016</small> <h2 class="mbr-info-subtitle mbr-section-subtitle">In unserem Archiv finden Sie Beiträge aus den letzten 11 Jahren. Hauptsächlich zu Themen rund um Drupal.</h2> </div> </div> </div> </div> </section> <section class="mbr-section article mbr-section__container" id=content1-35 style="background-color: rgb(255, 255, 255); padding-top: 60px; padding-bottom: 20px;"> <div class=container> <div class=row> <div class="col-xs-12 lead"> <article> <h1>AJAX ganz einfach - Digitaluhr für Drupal</h1> <p>Ansicht(aktiver Reiter) Bearbeiten Beiträge</p> <p>Startseite</p> <p>Tel.: 02331 3 96 16 91 Drupal Entwicklung Archiveintrag</p> <p>Dies ist ein älterer Artikel, der von das-drupal-magazin.de importiert wurde.</p> <p>mdwp* ist eine Drupal Agentur - für Beratung, Konzeption, Drupal SEO, Website-Entwicklung, Projektmanagement und Drupal Hosting. Drupal Consulting und Fullservice seit 2005. Geprüfte Acquia Partner. Wir stellen sicher, dass Ihre Websites auch auf mobilen Geräten optimal dargestellt werden. Site durchsuchen Suche AJAX ganz einfach - Digitaluhr für Drupal</p> <p>Wer wollte noch darauf verzichten - Websites mit dynamischen Inhalten sind einfach schick. Ein Klick, eine Mausbewegung, und auf magische Weise wird z.B. ein Textblock eingeblendet, ein Bild ausgetauscht, ein Popup angezeigt und Ähnliches - ohne die Seite komplett neu aufbauen zu müssen. Das spart Ladezeiten und gibt dem Betrachter das Gefühl, mit einem ganz normalen Anwendungsprogramm zu arbeiten.</p> <p>Zur Erzeugung von dynamischen Inhalten sind im wesentlichen zwei Techniken verbreitet: die Kombination von Javascript mit CSS, mit der z.B. ein verstecktes Seitenelement angezeigt und wieder ausgeblendet werden kann, sowie das sogenannte AJAX (Asynchronous JavaScript and XML), um das es hier gehen soll.</p> <p>Bei AJAX geht es im wesentlichen darum, Teile einer Seite (z.B. ein div Element) komplett auszutauschen und die neue Version des Elements dabei per HTTP-Request vom Server zu holen. Das ist auch der Hauptunterschied zwischen den beiden Ansätzen: beim Javascript/CSS-Ansatz müssen die geänderten Inhalte (wenn auch versteckt) bereits auf der Seite vorhanden sein (oder per Javascript erzeugt werden). Kein Problem bei Textblöcken, aber man stelle sich mal eine kleine Slideshow mit 50 Fotos vor, von denen 49 versteckt sind - seltsam, warum braucht das so lange zum Laden?</p> <p>Die reine Lehre von AJAX sieht vor, dass zum Aktualisieren eines Seitenelements ein XML-Objekt per HTTP-Request vom Server angefordert wird. Das vergessen wir am besten gleich wieder, in Drupal wird normalerweise mit einem pragmatischeren Ansatz gearbeitet: Drupal verwendet AJAX in Form von AHAH (Asynchronous HTML and HTTP) - ein etwas unglückliches Kürzel, gemeint ist dabei, dass Javascript per HTTP-Request HTML-Fragmente anstelle von XML-Objekten anfordert, das Kürzel sollte also besser AJAH heißen, aber sei es drum. Ich werde hier jetzt schlampigerweise einfach weiter von AJAX sprechen.</p> <p>Halten wir kurz fest: bei AJAX wird eine Seite mit einem dynamischen Element komplett aufgebaut, dann geschieht irgendein Javascript-Event (Mausklick, Mausbewegung, Timer o.ä.), Javascript ruft per HTTP-Request das Element als HTML-Fragment neu vom Server ab und tauscht es auf der Seite aus - voilá!</p> <p>Genug der Theorie, ran ans Werk: es soll ein kleines Modul entstehen, welches die aktuelle Uhrzeit in einem Block anzeigt und sekündlich per AJAX aktualisiert - armer Webserver! Das ist eigentlich relativ sinnfrei, da sich so etwas prima ohne AJAX mit reinem Javascript machen lässt, aber es ist ein hübsches Beispiel, um die Anwendung von AJAX auf einfachste Art zu demonstrieren. Fangen wir also mal an mit einem Modul namens CLOCK, das einfach nur die Uhrzeit in einem Block anzeigt:</p> <p>Wir benötigen ein clock.module:</p> <p>&lt;?php</p> <p>/** * Implementation of hook_block(). */ function clock_block($op = ‘list’, $delta = 0) { $block = array(); switch ($op) { case ‘list’: $block[0][‘info’] = ‘Digitaluhr’; break; case ‘view’: $block[‘content’] = clock_display(); break; } return $block; } /** * Display Clock */ function clock_display() {</p> <p>$output = ‘ ‘ . date(‘H:i:s’) . ‘</p> <p>’; return $output;</p> <p>}</p> <p>Und dazu ein clock.info:</p> <p>name = ‘Clock’ description = ‘Block mit Digitaluhr’ core = 6.x</p> <p>Dieses Modul können wir aktivieren, den erzeugten Block im Admin-Bereich einer Theme-Region zuordnen, und schon bekommen wir bei jedem Seitenaufruf die aktuelle Uhrzeit angezeigt. Aber um sie zu aktualisieren, muss die ganze Seite neu geladen werden. Nicht gerade sexy. Ein Fall für AJAX!</p> <p>Wir benötigen also ein kleines Script, nennen wir es clock.js, welches die Uhrzeit sekündlich aktualisieren soll. Und wir müssen Drupal diesen Wunsch bekanntgeben. Dazu gibt es die Funktion drupal_add_js, die wir der Anzeigefunktion beifügen können:</p> <p>// Hier liegt unser Modul auf dem Server $path = drupal_get_path(‘module’, ‘clock’); // Und hier liegt das Script dazu drupal_add_js ($path . ‘/js/clock.js’);</p> <p>Ein wenig Design kann auch nicht schaden, machen wir die Ziffern doppelt so groß und stellen die Uhrzeit zentriert dar! Das geht analog durch die Angabe einer passenden CSS-Datei:</p> <p>// Und die CSS-Datei zu unserem Modul drupal_add_css ($path . ‘/css/clock.css’);</p> <p>Hier die clock.css :</p> <h1 id=clock-font-size2emtext-aligncenter>clock {font-size:2em;text-align:center;}</h1> <p>Auf jeder Seite, die unseren Block enthält, wird nun im Header das entsprechende JavaScript und CSS eingebunden. Und jetzt das Spannende, nämlich AJAX:</p> <p>Wir benötigen ein Script, das sekündlich die aktuelle Uhrzeit vom Server holt und den Inhalt des DIVs mit der ID “clock” aktualisiert. Was aber heißt “vom Server holen”? Per Javascript wird eine Seite (URI) aufgerufen, deren Ausgabe die gewünschte Information ist. Wir müssen also unser Modul entsprechend ergänzen. Seiten werden in Drupal über hook_menu definiert, als URI verwenden wir einfach “/clock/refresh”.</p> <p>/** * Implementation of hook_menu(). */ function clock_menu() {</p> <p>$items[‘clock/refresh’] = array( // Das ist die URI ‘page callback’ =&gt; ‘clock_refresh’, // Kann ruhig jeder sehen ‘access callback’ =&gt; TRUE, // Im Menü brauchen wir das nicht! ‘type’ =&gt; MENU_CALLBACK, );</p> <p>return $items;</p> <p>}</p> <p>/** * Refresh Clock */ function clock_refresh() { $output = date(“H:i:s”); die($output); }</p> <p>Huh, das klingt tödlich. Aber der PHP Befehl “die” oder alternativ “exit” sorgt einfach dafür, dass das laufende Skript beendet wird, Drupal also keine weiteren Seitenelemente mehr drumherum basteln muss. Wir erhalten die Uhrzeit, und nichts als die Uhrzeit.</p> <p>Zum Testen einfach mal die Seite im Browser aufrufen (‘www.beispiel.de/clock/refresh’), und wer misstrauisch ist, werfe mal einen Blick in den Seitenquellcode!</p> <p>Fehlt nur noch das Javascript! Drupal verwendet das wunderbare Javascript-Framework jQuery, und jQuery bietet den Befehl load(), mit dem sich Seitenelemente ganz einfach per HTTP-Request aktualisieren lassen. Damit wird das Aktualisieren des DIVs mit der Uhrzeit ein Klacks, nämlich mittels unserer Javascript-Datei clock.js:</p> <p>function refresh() { // Holt die aktuelle Uhrzeit vom Server $(‘#clock’).load(‘/clock/refresh’); }</p> <p>Und das Ganze soll jetzt noch sekündlich geschehen:</p> <p>$(document).ready(function(){ // Ruft die Funktion ein mal pro Sekunde auf. setInterval (“refresh()”,1000); });</p> <p>So, sehr schön, wir haben einen Block mit einer sekündlich aktualisierten Digitaluhr. Aber da wären noch zwei hübsche Fallstricke versteckt: was geschieht eigentlich, wenn der Benutzer JavaScript deaktiviert hat? Eine Frage, die man sich beim Arbeiten mit Javascript immer stellen sollte! Entweder wir zeigen dann nur die beim Laden der Seite aktuelle Uhrzeit an, oder es erscheint ein Hinweis an den Benutzer, dass er Javascript aktivieren soll. Für letzteres ändern wir die Ausgabe des Blocks ein wenig und passen das Script entsprechend an:</p> <p>/** * Display Clock */ function clock_display() {</p> <p>$path = drupal_get_path(‘module’, ‘clock’); drupal_add_js ($path . ‘/js/clock.js’); drupal_add_css ($path . ‘/css/clock.css’);</p> <p>$output = “ Javascript erforderlich!</p> <p>”; return $output;</p> <p>}</p> <p>$(document).ready(function(){ refresh(); setInterval (“refresh()”,1000); });</p> <p>Wenn ein Benutzer Javascript deaktiviert hat, erscheint der Hinweis “Javascript erforderlich”, ansonsten wird (fast) sofort die aktuelle Uhrzeit eingeblendet. Da setInterval die angegebene Zeit erst verstreichen lässt, bevor es den Refresh auslöst, müssen wird das einmalig direkt veranlassen.</p> <p>Den zweiten Fallstrick hält Drupal für uns bereit, und der ist ganz gemein:</p> <p>Wir wollen natürlich eine gute Performance auf unserer Seite, und haben deshalb die Caching-Funktionen von Drupal aktiviert, insbesondere den Block-Cache. Alles sieht ganz normal aus, solange wir eingeloggt sind (Drupal cacht keine Inhalte für angemeldetete Benutzer). Aber nach dem Logout steht in unserem schönen Block plötzlich nur “Javascript erforderlich!”, und zwar in einfacher Schriftgröße und linksbündig! Ein Blick in den Seiten-Quellcode verrät uns: clock.js und clock.css sind verschwunden! Wie das denn? Ganz einfach: der Block-Cache von Drupal speichert die HTML-Ausgabe des Blocks, also nur den erzeugten Text. Die Funktionen zum Einfügen von JavaScript und CSS in die Seite werden nicht aufgerufen, und die Seite selbst weiß nicht dass die beiden Dateien hier benötigt werden. Dieses unerwünschte Verhalten gilt es abzustellen. Wir könnten jetzt den Block-Cache generell deaktivieren, aber sinnvollerweise tun wir das nur für unseren Digitaluhrblock, indem wir Drupal das Cachen einfach verbieten:</p> <p>… switch ($op) { case ‘list’: $block[0][‘info’] = ‘Digitaluhr’; // Dieser Block darf nicht gecacht werden! $block[0][‘cache’] = DRUPAL_NO_CACHE; break; case ‘view’: …</p> <p>Jetzt klappt alles wie gewünscht. Das Beispiel mit der Digitaluhr ist wie erwähnt etwas sinnfrei, aber mit dieser Methode lassen sich natürlich ganz andere dynamische Inhalte erzeugen. Der Schlüssel dabi ist im Prinzip die Refresh-Funktion mit dem Abbruch der Skriptausgabe. Hier kann man eine Uhrzeit ausgeben, aber z.B. auch Inhalte aus der Datenbank holen, Bilder zurückgeben, externe Daten anziehen, Eintragungen sortieren, ein Popup erzeugen etc - der Fantasie sind hier keine Grenzen gesetzt.</p> <p>Zum Abschluss noch mal das komplette Modul und JavaScript:</p> <p>clock.module:</p> <p>&lt;?php</p> <p>/** * Implementation of hook_menu(). */ function clock_menu() {</p> <p>$items[‘clock/refresh’] = array( ‘page callback’ =&gt; ‘clock_refresh’, ‘access callback’ =&gt; TRUE, ‘type’ =&gt; MENU_CALLBACK, );</p> <p>return $items;</p> <p>} /** * Implementation of hook_block(). */ function clock_block($op = ‘list’, $delta = 0) { $block = array(); switch ($op) { case ‘list’: $block[0][‘info’] = ‘Digitaluhr’; $block[0][‘cache’] = DRUPAL_NO_CACHE; break; case ‘view’: $block[‘content’] = clock_display(); break; } return $block; } /** * Display Clock */ function clock_display() {</p> <p>$path = drupal_get_path(‘module’, ‘clock’); drupal_add_js ($path . ‘/js/clock.js’); drupal_add_css ($path . ‘/css/clock.css’);</p> <p>$output = “ Javascript erforderlich!</p> <p>”; return $output;</p> <p>} /** * Refresh Clock */ function clock_refresh() { $output = date(“H:i:s”); die($output); }</p> <p>clock.js:</p> <p>function refresh() { $(‘#clock’).load(‘/clock/refresh’); } $(document).ready(function(){ refresh(); setInterval (“refresh()”,1000); });</p> <p>Autor: Boris Böhne</p> <p>http://www.boehne.com</p> </article> </div> </div> </div> </section> <section class="mbr-footer footer4 mbr-section mbr-section-md-padding" id=contacts4-75 style="background-color: rgb(46, 46, 46); padding-top: 90px; padding-bottom: 90px;"> <div class=container> <div class="mbr-contacts row"> <div class=col-sm-8> <div class=row> <div class=col-sm-6> <p><strong>Adresse</strong><br>Hügelstr. 6a<br>58099 Hagen<br><br><br> <strong><a href="/kontakt">Kontakt</a></strong><br> E-Mail: meinolf.droste@mdwp.de<br> Tel.: 02331 62 85 27 3<br></p> </div> <div class=col-sm-6><p class=mbr-contacts__text><strong>mdwp in den sozialen Medien</strong></p><ul class=mbr-contacts__list> <li><a class=text-white href="https://facebook.com/mdwp.de" target=_blank>Facebook</a></li> <li><a class=text-white href="https://twitter.com/mdwp" target=_blank>Twitter</a></li> <li><a href="https://github.com/capriosa" target=_blank>Github</a></li> <li><a href="https://disqus.com/by/mdroste/" target=_blank>Disqus</a></li> <li><a href="/m-droste/">Über M. Droste</a></li> </ul></div> </div> </div> <div class=col-sm-4 data-form-type=formoid> <div data-form-alert=true> <div hidden="" data-form-alert-success=true>Vielen Dank für Ihre Anfrage!</div> </div> <form method=post data-form-title="Nachricht aus mdwp footer"> <input type=hidden value="J7TWV6GKbIjZ2cgZiuoQqfUN0Z3iRcw7JhHwTw8PBBK7NRt0Meg173jE+xbt4FMoJnxK/oPqNAg2sc8rVtchwqJFlULmxjmvv7rdhLb08MYRUSWWS7nH3LZ1nB9rXqjX" data-form-email=true> <div class=form-group> <label class=form-control-label for=contacts4-75-name>Firma/Name<span class=form-asterisk>*</span></label> <input class="form-control input-sm input-inverse" name=name required="" data-form-field=Name id=contacts4-75-name> </div> <div class=form-group> <label class=form-control-label for=contacts4-75-email>E-Mail<span class=form-asterisk>*</span></label> <input type=email class="form-control input-sm input-inverse" name=email required="" data-form-field=Email id=contacts4-75-email> </div> <div class=form-group> <label class=form-control-label for=contacts4-75-message>Ihre Nachricht</label> <textarea class="form-control input-sm input-inverse" name=message data-form-field=Message rows=4 id=contacts4-75-message></textarea> </div> <div class="mbr-buttons mbr-buttons--right btn-inverse"><button type=submit class="btn btn-sm btn-black">Senden</button></div> </form> </div> </div> </div> </section> <footer class="mbr-small-footer mbr-section mbr-section-nopadding" id=footer1-76 style="background-color: rgb(50, 50, 50); padding-top: 1.75rem; padding-bottom: 1.75rem;"> <div class=container> <p class=text-xs-center>Copyright (c) 2016 mdwp. &nbsp;Bilder teilweise by Unsplash.com</p> </div> </footer> <link rel=author href="https://plus.google.com/104314608492946919397"/> <link rel=stylesheet href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic&amp;subset=latin"> <link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700"> <link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway:400,100,200,300,500,600,700,800,900"> <link rel=stylesheet href="/assets/animate.css/animate.min-97afa151.css"> <link rel=stylesheet href="/assets/et-line-font-plugin/style-12e02cc6.css"> <link rel=stylesheet href="/assets/bootstrap-material-design-font/css/material-0c77e502.css"> <link rel=stylesheet href="/assets/tether/tether.min-4c02e993.css"> <link rel=stylesheet href="/assets/socicon/css/socicon.min-2849af3d.css"> <link rel=stylesheet href="/assets/dropdown/css/style-151d9b88.css"> <link rel=stylesheet href="/assets/theme/css/style-fecffea7.css"> <link rel=stylesheet href="/assets/mobirise/css/mbr-additional-748e52a7.css"> <script src="/assets/web/assets/jquery/jquery.min-8130544c.js"></script> <script src="/assets/tether/tether.min-345421c0.js"></script> <script src="/assets/bootstrap/js/bootstrap.min-fad10c3c.js"></script> <script src="/assets/smooth-scroll/SmoothScroll-f2c1a7b9.js"></script> <script src="/assets/viewportChecker/jquery.viewportchecker-a45f5798.js"></script> <script src="/assets/dropdown/js/script.min-c957f98e.js"></script> <script src="/assets/touchSwipe/jquery.touchSwipe.min-69c8c9f0.js"></script> <script src="/assets/jarallax/jarallax-08e41bcd.js"></script> <script src="/assets/mobirise/js/script-61a2faae.js">
<script src="/assets/theme/js/script-9d38bd3b.js"></script> <script src="assets/formoid/formoid.min.js"></script> <input name=animation type=hidden> </body> </html>